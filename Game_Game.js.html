<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Game/Game.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Game/Game.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Main Game File
 * @class
 */
class Game {
    /** @constructor */
    constructor() {
        /** set _ctxWorld and _ctxUi dimensions */
        this.setCanvasSize();
        /** @property {MouseHandler} */
        this.mousehandler = new MouseHandler(this);
        this.mousehandler.add('.fullscreen', 'click', 'doFullscreen');
        /** @property {KeyboardHandler} */
        this.keyboardHandler = new KeyboardHandler(this);
        this.keyboardHandler.setDefault();
        this.keyboardHandler.add(document, 'keydown', 'doFullscreen', [70, 13]);
        /** @property {Joystick} */
        this.joystickHandler = new Joystick();
        /** @property {Fullscreen} */
        this.fullscreenHandler = new Fullscreen();
        /** @property {Loader} */
        this.loader = new Loader(this);
        /**@property {Assets} */
        this._assets = new Assets(this);
        /** @property {Floors} */
        this._floors = new Floors(this);
        /** @property {Skills} */
        this._skills = new Skills();
        /** @property {Player} */
        this._player = new Player();

        /** @property {boolean} stopGame  - stop the rendering loop */
        this.stopGame = false;
        // rendering loop
        this.raF = 0;
        /** @property {number} delta - rendering loop delta */
        this.delta = 0;
        /** @property {number} lastTimestamp - rendering loop timestamp */
        this.lastTimestamp = 0;
    }
    /** first function called > get from DB */
    preloader() {
        /** initial loading from DB */
        this.loader.add('data', 'initLoad', {
            type: 'initLoad',
            level: this._floors.floorLevel,
            name: playerName
        });
        /** @type {UserInterface} */
        this.ui = new UserInterface(this);
        /** calls > preloaderResult */
        this.loader.run();
    }
    /**
     * will be called when data returns from loader.run
     * @param  {array} result db return
     * @method
     */
    preloaderResult(result) {
        /** multiple DB results */
        if (result[0].type == 'group') {
            let data = result[0].result;
            for (const property in data) {
                if (typeof this[property] === 'object') {
                    this[property].init(data[property]);
                } else {
                    console.log(property + ' not defined');
                }
            }
            /** initialize the game */
            this.init();
        } else {
            /** single DB result */
            // old way > change in gen (used for single operations atm)
            for (let i = 0; i &lt; result.length; i++) {
                /** if floor is returned call init */
                if (result[i].name == "floors") {
                    this._floors.init(result[i].result);
                }
                /** returned player after saving it */
                // if (result[i].name == "player") {
                //     this._player.init(result[i].result);
                // }
                /** returned player after saving it */
                if (result[i].name == "playerUid") {
                    this._player.setUid(result[i].result);
                }
            }
            if (this.stopGame == true) {
                /** start the game if it got stopped */
                this.init();
            }
        }
    }
    /** initialization of game */
    init() {
        /** add classes to hide loader */
        this.loader.hide();
        /** trigger UI repaint */
        this.ui.repaint = true;
        this.resize();
        this.start();
    }

    /************************
     **** Canvas changes ****
     ************************/
    animate() {
        let now = Date.now(),
            timeDelta = (now - (this.lastTimestamp || now)) / 1000; // in seconds
        this.delta = timeDelta * 30; // meaning: 30px per second

        // clear both canvas
        _ctxWorld.save();
        // used to removed old translate
        _ctxWorld.setTransform(1, 0, 0, 1, 0, 0);
        _ctxWorld.fillStyle = 'black';
        _ctxWorld.fillRect(0, 0, _ctxWorld.canvas.width, _ctxWorld.canvas.height);
        //_ctxWorld.clearRect(0, 0, _ctxWorld.canvas.width, _ctxWorld.canvas.height);
        _ctxWorld.restore();

        //let fps = Math.round(1000 / (now - this.lastTimestamp));
        this.lastTimestamp = now;
        //console.log("fps", fps);
        this.draw();

        if (!this.stopGame == true) {
            this.raF = requestAnimationFrame(() => this.animate());
        } else {
            this.raF = null;
        }
    }
    draw() {
        this._floors.draw();
        if (this.ui.repaint == true) {
            this.ui.draw();
        }
    }
    setCanvasSize() {
        _ctxWorld.canvas.width = window.innerWidth;
        _ctxWorld.canvas.height = window.innerHeight;
        _ctxUi.canvas.width = window.innerWidth;
        _ctxUi.canvas.height = window.innerHeight;
    }
    resize() {
        this.setCanvasSize();
        this.ui.repaint = true;
        this._floors.resize();
        this._player.resize();
        this.ui.resize();
        // paint single frame on resize
        if (this.stopGame == true) {
            this.draw();
        }
    }
    stop() {
        this.stopGame = true;
        this.keyboardHandler.reset();
        document.body.classList.add('suspended');
    }
    start() {
        //this.ui.repaint = true;
        this.stopGame = false;
        this.animate();
        document.body.classList.remove('battle', 'suspended');
    }
    doFullscreen(event) {
        this.fullscreenHandler.toggle();
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AbstractCharacter.html">AbstractCharacter</a></li><li><a href="Action.html">Action</a></li><li><a href="Assets.html">Assets</a></li><li><a href="Game.html">Game</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun Mar 14 2021 18:14:56 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
